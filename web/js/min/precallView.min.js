(e=>{let t;let n;let l,i,o;function s(e){const o=[t.render(),n.render(),l.render()];showTos&&o.push(i.render()),Promise.all(o).then(t=>{t.forEach(e=>{document.body.insertAdjacentHTML("afterbegin",e)}),window.routedFromStartMeeting&&(document.querySelector(".main").style.display="none",e()),(()=>{if(window.enablePrecallTest){const e=document.getElementById("pre-call-test-results");e.addEventListener("click",t=>{switch(t.target.id){case"precall-close":e.style.display="none";break;case"retest":e.style.display="none",document.getElementById("connectivity-cancel").style.display="inline-block",Utils.sendEvent("roomView:retest")}});const t=document.getElementById("connectivity-cancel");t.addEventListener("click",n=>{n.preventDefault(),Utils.sendEvent("roomView:cancelTest"),t.style.display="none",e.style.display="none",c()})}const e=document.getElementById("user-name-input");e.addEventListener("keypress",(function t(){document.querySelector(".user-name-input-container").classList.add("visited"),e.removeEventListener("keypress",t)})),document.querySelector(".user-name-modal").addEventListener("click",()=>{e.focus()});document.querySelector(".publish-settings").addEventListener("click",e=>{const t=document.querySelector("#initialVideoSwitch"),n=document.querySelector("#initialAudioSwitch");setTimeout(()=>{document.activeElement.blur()},1);const l=HTMLElems.getAncestorByTagName(e.target,"a");if(l)switch(l.id){case"preToggleFacingMode":Utils.sendEvent("roomView:toggleFacingMode");break;case"prePickMic":{const e=document.getElementById("select-devices");e.style.display="inline-block",Modal.showConfirm({head:"Set mic input",detail:"Please identify the audio source in the following list:",button:"Set"},!0).then(t=>{t&&Utils.sendEvent("roomView:setAudioSource",e.value),e.style.display="none"});break}case"initialAudioSwitch":n.classList.contains("activated")?u(!1,"Audio","roomView:initialAudioSwitch"):u(!0,"Audio","roomView:initialAudioSwitch");break;case"initialVideoSwitch":t.classList.contains("activated")?u(!1,"Video","roomView:initialVideoSwitch"):u(!0,"Video","roomView:initialVideoSwitch")}})})(),window.enablePrecallTest&&(document.getElementById("pre-call-test").style.display="flex",document.getElementById("precall-test-meter").style.display="block"),e()})}const a={"PrecallController:endPrecall":function(){(void 0).addEventListener("value",s),s()},"PrecallController:audioOnly":function(){u(!1,"Video","roomView:initialVideoSwitch")}};var c=()=>{document.getElementById("pre-call-test").style.display="none",document.getElementById("precall-test-meter").style.display="none"};let d=!1;const r=()=>{Utils.removeEventHandlers("modal:",{close:r}),Modal.show(".user-name-modal")};var m=e=>{const t=e*document.getElementById("precall-test-meter").offsetWidth;document.getElementById("precall-test-meter-level").style.width=t+"px"};function u(e,t,n){const l=`initial${t}Switch`,i=document.getElementById(l),o=i.querySelector("label"),s=i.classList.contains("activated");let a;void 0===e?(a=i.classList.toggle("activated"),o.innerText="On"):(a=e,e?(i.classList.add("activated"),o.innerText="On"):(i.classList.remove("activated"),o.innerText="Off")),a!==s&&Utils.sendEvent(n,{status:a})}this.PrecallView={init:()=>new Promise(e=>d?e():(Utils.addEventsHandlers("",a),t=new EJSTemplate({url:"/templates/precall.ejs"}),showTos&&(i=new EJSTemplate({url:"/templates/tos.ejs"})),n=new EJSTemplate({url:"/templates/unavailable.ejs"}),l=new EJSTemplate({url:"/templates/locked.ejs"}),d=!0,s(e))),hide:()=>{document.querySelector(".main").style.display="none",Utils.removeEventHandlers("modal:",{close:r})},populateAudioDevicesDropdown:(e,t)=>{const n=document.getElementById("select-devices");e.forEach(e=>{const l=document.createElement("option");l.text=e.label,l.value=e.deviceId,l.value===t&&(l.selected=!0),n.appendChild(l)})},setFocus:e=>{const t=e?document.getElementById("enter"):document.getElementById("user-name-input");t&&t.focus()},setVolumeMeterLevel:e=>{document.getElementById("audio-meter-level").style.width=89*e+"px"},showContract:()=>{const e=".tc-modal.contract",t=document.querySelector(e+" .accept");return Modal.show(e,null,!0).then(()=>new Promise(n=>{t.addEventListener("click",(function l(i){t.removeEventListener("click",l),i.preventDefault(),sessionStorage.setItem("tosAccepted",!0),Modal.hide(e),n()})),Utils.addEventsHandlers("modal:",{close:r})}))},showUnavailableMessage:()=>Modal.show(".tc-modal.unavailable",null,!0),showLockedMessage:()=>Modal.show(".tc-modal.locked",null,!0),startPrecallTestMeter:()=>{const e=document.getElementById("precall-test-meter-level");u(!0,"Video","roomView:initialVideoSwitch"),document.querySelector("#test-status label").innerText="Testing audio / video qualityâ€¦",e.style.width=0,e.style["animation-play-state"]="running";let t=0;o=setInterval(()=>{t++,m(t/200),200===t&&clearInterval(o)},100)},displayNetworkTestResults:e=>{let t;clearInterval(o),document.querySelector("#test-status label").innerText="Done.",document.getElementById("precall-test-meter-level").style["animation-play-state"]="paused",m(1),document.getElementById("connectivity-cancel").style.display="none",document.getElementById("pre-call-test-results").style.display="block",document.getElementById("audio-bitrate").innerText=Math.round(e.audio.bitsPerSecond/1e3),e.video?(document.getElementById("video-bitrate").innerText=Math.round(e.video.bitsPerSecond/1e3),t=isNaN(e.video.packetLossRatio)?"":Math.round(100*e.video.packetLossRatio)+"% packet loss",document.getElementById("precall-video-packet-loss").innerText=t):(document.getElementById("video-bitrate").innerText=0,document.getElementById("precall-video-packet-loss").innerText="No video.");const n=document.getElementById("pre-call-heading");switch(n.classList=e.classification,e.classification){case"precall-tick":n.innerText="Excellent Connectivity";break;case"precall-warning":n.innerText="OK Connectivity";break;case"precall-error":n.innerText="Poor Connectivity"}document.getElementById("pre-call-description").innerText=e.text,document.getElementById("precall-icon").setAttribute("data-icon",e.classification),t=isNaN(e.audio.packetLossRatio)?"":Math.round(100*e.audio.packetLossRatio)+"% packet loss",document.getElementById("precall-audio-packet-loss").innerText=t},hideConnectivityTest:c}})();